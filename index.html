<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>NyashGram</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;500;700&family=Fredoka:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>

<div id="app">

  <!-- –≠–∫—Ä–∞–Ω –Ω–æ–º–µ—Ä–∞ -->
  <section id="phoneScreen" class="screen active">
    <div class="container">
      <h1>NyashGram ü©∑</h1>
      <p>–í—Ö–æ–¥ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞</p>

      <div class="phone-input">
        <select id="countryCode">
          <option value="+7">+7 –†–æ—Å—Å–∏—è</option>
          <option value="+380">+380 –£–∫—Ä–∞–∏–Ω–∞</option>
          <option value="+375">+375 –ë–µ–ª–∞—Ä—É—Å—å</option>
        </select>
        <input type="tel" id="phoneNumber" placeholder="999 999 99 99" />
      </div>

      <div id="phoneError"></div>
      <button id="sendBtn" disabled>–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥</button>
    </div>
  </section>

  <!-- –≠–∫—Ä–∞–Ω —Ñ–µ–π–∫–æ–≤–æ–≥–æ –∫–æ–¥–∞ -->
  <section id="codeScreen" class="screen">
    <div class="container">
      <h1>NyashGram ü©∑</h1>
      <p>–í–≤–µ–¥–∏ –∫–æ–¥</p>

      <input type="text" id="codeInput" placeholder="------" maxlength="6" autocomplete="off" />

      <div id="codeError" style="color:#e74c3c; font-size:14px; margin-top:12px; min-height:20px;"></div>
      <button id="verifyBtn" disabled>–í–æ–π—Ç–∏</button>
    </div>
  </section>

  <!-- –ö–û–ù–¢–ê–ö–¢–´ -->
  <section id="contactsScreen" class="screen">
    <header class="top-bar">
      <div class="top-title">–ö–æ–Ω—Ç–∞–∫—Ç—ã</div>
    </header>
    <div id="contactsList"></div>
  </section>

  <!-- –ß–ê–¢ -->
  <section id="chatScreen" class="screen">
    <header class="top-bar">
      <button id="backBtn">‚Üê</button>
      <div class="chat-header">
        <div id="chatAvatar" class="avatar"></div>
        <div>
          <div id="chatName"></div>
          <div id="chatStatus" class="status"></div>
        </div>
      </div>
    </header>

    <div id="messages"></div>

    <div class="input-bar">
      <input id="messageInput" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
      <button id="sendBtn">‚û§</button>
    </div>
  </section>

</div>

<script>
  let generatedCode = "";
  let currentChat = null;
  const chatData = {};

  function generateCode() {
    generatedCode = Math.floor(100000 + Math.random() * 900000).toString();
    document.getElementById("codeInput").placeholder = generatedCode.split("").join(" ");
  }

  function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  // –≠–∫—Ä–∞–Ω –Ω–æ–º–µ—Ä–∞
  const phoneInput = document.getElementById("phoneNumber");
  const sendBtn = document.getElementById("sendBtn");
  const phoneError = document.getElementById("phoneError");

  function checkPhone() {
    const phone = phoneInput.value.trim().replace(/\D/g, "");
    if (phone.length >= 9) {
      sendBtn.classList.add("active");
      sendBtn.disabled = false;
      phoneError.textContent = "";
    } else {
      sendBtn.classList.remove("active");
      sendBtn.disabled = true;
      phoneError.textContent = phone.length === 0 ? "" : "–ù–æ–º–µ—Ä —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π";
    }
  }

  phoneInput.addEventListener("input", checkPhone);
  checkPhone();

  sendBtn.addEventListener("click", () => {
    generateCode();
    showScreen("codeScreen");
  });

  // –≠–∫—Ä–∞–Ω –∫–æ–¥–∞
  const codeInput = document.getElementById("codeInput");
  const verifyBtn = document.getElementById("verifyBtn");
  const codeError = document.getElementById("codeError");

  codeInput.addEventListener("input", () => {
    const entered = codeInput.value.trim();
    if (entered.length === 6) {
      if (entered === generatedCode) {
        codeError.textContent = "";
        verifyBtn.classList.add("active");
        verifyBtn.disabled = false;
      } else {
        codeError.textContent = "–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥";
        verifyBtn.classList.remove("active");
        verifyBtn.disabled = true;
      }
    } else {
      codeError.textContent = "";
      verifyBtn.classList.remove("active");
      verifyBtn.disabled = true;
    }
  });

  verifyBtn.addEventListener("click", () => {
    showScreen("contactsScreen");
    renderContacts(); // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–∞–∫—Ç—ã
  });

  // –ó–∞–ø—É—Å–∫
  showScreen("phoneScreen");
</script>
</body>
</html>