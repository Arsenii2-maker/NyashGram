<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>NyashGram</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;500;700&family=Fredoka:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>

<div id="app">

  <!-- –≠–∫—Ä–∞–Ω –Ω–æ–º–µ—Ä–∞ -->
  <section id="phoneScreen" class="screen active">
    <div class="container">
      <h1>NyashGram ü©∑</h1>
      <p>–í—Ö–æ–¥ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞</p>

      <div class="phone-input">
        <select id="countryCode">
          <option value="+7">+7 –†–æ—Å—Å–∏—è</option>
          <option value="+380">+380 –£–∫—Ä–∞–∏–Ω–∞</option>
        </select>
        <input type="tel" id="phoneNumber" placeholder="999 999 99 99" />
      </div>

      <div id="phoneError"></div>
      <button id="sendBtn" disabled>–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥</button>
    </div>
  </section>

  <!-- –≠–∫—Ä–∞–Ω —Ñ–µ–π–∫–æ–≤–æ–≥–æ –∫–æ–¥–∞ -->
  <section id="codeScreen" class="screen">
    <div class="container">
      <h1>NyashGram ü©∑</h1>
      <p>–í–≤–µ–¥–∏ –∫–æ–¥</p>

      <input type="text" id="codeInput" placeholder="------" maxlength="6" autocomplete="off" />

      <div id="codeError" style="color:#e74c3c; font-size:14px; margin-top:12px; min-height:20px;"></div>
      <button id="verifyBtn" disabled>–í–æ–π—Ç–∏</button>
    </div>
  </section>

  <!-- –≠–∫—Ä–∞–Ω –ø—Ä–æ—Ñ–∏–ª—è -->
  <section id="profileScreen" class="screen">
    <div class="container">
      <h1>–°–æ–∑–¥–∞–π –ø—Ä–æ—Ñ–∏–ª—å</h1>

      <input type="text" id="displayName" placeholder="–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?" style="width:100%; margin:16px 0;" />

      <div style="margin:20px 0;">
        <label for="avatarInput">
          <div id="avatarPreview" style="width:120px; height:120px; background:#ff9acb; border-radius:50%; margin:0 auto; display:flex; align-items:center; justify-content:center; font-size:40px; color:white;">+</div>
          <p style="margin-top:12px;">–í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ</p>
        </label>
        <input type="file" id="avatarInput" accept="image/*" style="display:none;" />
      </div>

      <button id="saveProfileBtn">–ì–æ—Ç–æ–≤–æ!</button>
    </div>
  </section>

  <!-- –ù–ê–°–¢–†–û–ô–ö–ò -->
  <section id="settingsScreen" class="screen">
    <header class="top-bar">
      <button id="settingsBackBtn">‚Üê</button>
      <div class="top-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
    </header>

    <div style="padding:16px; display:flex; flex-direction:column; gap:16px">
      <label>
        –ù–∏–∫–Ω–µ–π–º
        <input id="settingsName">
      </label>

      <label>
        –ê–≤–∞—Ç–∞—Ä–∫–∞
        <input type="file" id="avatarInputSettings" accept="image/*">
        <div style="margin-top:8px;">
          <div id="avatarPreviewSettings" class="avatar" style="width:80px; height:80px; margin:0 auto;"></div>
        </div>
      </label>

      <label>
        –¢–µ–º–∞
        <select id="themeSelect">
          <option value="pastel-pink">Pastel Pink ü©∑</option>
          <option value="milk-rose">Milk Rose üå∏</option>
          <option value="night-blue">Night Blue üåô</option>
        </select>
      </label>

      <label>
        –®—Ä–∏—Ñ—Ç
        <select id="fontSelect">
          <option value="system">System</option>
          <option value="rounded">Rounded</option>
          <option value="cozy">Cozy</option>
        </select>
      </label>

      <button id="saveSettingsBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </section>

  <!-- –ö–û–ù–¢–ê–ö–¢–´ -->
  <section id="contactsScreen" class="screen">
    <header class="top-bar">
      <button id="settingsBtn">‚öôÔ∏è</button>
      <div class="top-title">–ö–æ–Ω—Ç–∞–∫—Ç—ã</div>
    </header>
    <div id="contactsList"></div>
  </section>

  <!-- –ß–ê–¢ -->
  <section id="chatScreen" class="screen">
    <header class="top-bar">
      <button id="backBtn">‚Üê</button>
      <div class="chat-header">
        <div id="chatAvatar" class="avatar"></div>
        <div>
          <div id="chatName"></div>
          <div id="chatStatus" class="status"></div>
        </div>
      </div>
    </header>

    <div id="chatIntro" class="chat-intro">
      <div class="intro-title">‚ú® –ù–∞—á–Ω–∏ –æ–±—â–µ–Ω–∏–µ ‚ú®</div>
      <div class="intro-buttons">
        <button>–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?</button>
        <button>–ß–µ–º –∑–∞–Ω–∏–º–∞–µ—à—å—Å—è?</button>
        <button>–•–æ—á–µ—à—å –ø–æ–±–æ–ª—Ç–∞—Ç—å?</button>
        <button>–ö–∞–∫–æ–π –≤–∞–π–± —Å–µ–≥–æ–¥–Ω—è?</button>
      </div>
    </div>

    <div id="messages"></div>

    <div class="input-bar">
      <input id="messageInput" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
      <button id="sendBtn">‚û§</button>
    </div>
  </section>

</div>

<script>
  // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
  let currentChat = null;
  const chatData = {}; // { chatId: { messages: [], draft: "" } }

  // –§–µ–π–∫–æ–≤—ã–π –∫–æ–¥
  let generatedCode = "";

  function generateCode() {
    generatedCode = Math.floor(100000 + Math.random() * 900000).toString();
    document.getElementById("codeInput").placeholder = generatedCode.split("").join(" ");
  }

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤
  function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  // –≠–∫—Ä–∞–Ω –Ω–æ–º–µ—Ä–∞
  const phoneInput = document.getElementById("phoneNumber");
  const sendBtn = document.getElementById("sendBtn");
  const phoneError = document.getElementById("errorMessage");

  function checkPhone() {
    const phone = phoneInput.value.trim().replace(/\D/g, "");
    if (phone.length >= 9) {
      sendBtn.classList.add("active");
      sendBtn.disabled = false;
      phoneError.textContent = "";
    } else {
      sendBtn.classList.remove("active");
      sendBtn.disabled = true;
      phoneError.textContent = phone.length === 0 ? "" : "–ù–æ–º–µ—Ä —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π";
    }
  }

  phoneInput.addEventListener("input", checkPhone);
  checkPhone();

  sendBtn.addEventListener("click", () => {
    generateCode();
    showScreen("codeScreen");
  });

  // –≠–∫—Ä–∞–Ω –∫–æ–¥–∞
  const codeInput = document.getElementById("codeInput");
  const verifyBtn = document.getElementById("verifyBtn");
  const codeError = document.getElementById("codeError");

  codeInput.addEventListener("input", () => {
    const entered = codeInput.value.trim();
    if (entered.length === 6) {
      if (entered === generatedCode) {
        codeError.textContent = "";
        verifyBtn.classList.add("active");
        verifyBtn.disabled = false;
      } else {
        codeError.textContent = "–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥";
        verifyBtn.classList.remove("active");
        verifyBtn.disabled = true;
      }
    } else {
      codeError.textContent = "";
      verifyBtn.classList.remove("active");
      verifyBtn.disabled = true;
    }
  });

  verifyBtn.addEventListener("click", () => {
    showScreen("profileScreen");
  });

  // –≠–∫—Ä–∞–Ω –ø—Ä–æ—Ñ–∏–ª—è
  document.getElementById("avatarInput").addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (event) => {
        document.getElementById("avatarPreview").style.backgroundImage = `url(${event.target.result})`;
        document.getElementById("avatarPreview").textContent = "";
      };
      reader.readAsDataURL(file);
    }
  });

  document.getElementById("saveProfileBtn").addEventListener("click", () => {
    const name = document.getElementById("displayName").value.trim();
    if (!name) return alert("–í–≤–µ–¥–∏ –∏–º—è!");
    alert("–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å ü©∑");
    showScreen("contactsScreen");
    renderContacts();
  });

  // –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ —á–∞—Ç—ã
  const contacts = [
    { id: "bestie", name: "Bestie", status: "online", avatar: "linear-gradient(135deg, #ff9acb, #ffd6e8)" },
    { id: "filosof", name: "–§–∏–ª–æ—Å–æ—Ñ", status: "–ø–∏—à–µ—Ç —Ç—Ä–∞–∫—Ç–∞—Ç", avatar: "linear-gradient(135deg, #6c5ce7, #a29bfe)" },
    { id: "ucheba", name: "–£—á—ë–±–∞", status: "–≥–æ—Ç–æ–≤–ª—é—Å—å –∫ —ç–∫–∑–∞–º–µ–Ω—É", avatar: "linear-gradient(135deg, #74b9ff, #0984e3)" },
    { id: "music", name: "Music Pal", status: "—Å–ª—É—à–∞—é lo-fi", avatar: "linear-gradient(135deg, #fdcb6e, #e17055)" },
    { id: "night", name: "Night Chat", status: "–Ω–µ —Å–ø–ª—é", avatar: "linear-gradient(135deg, #2d3436, #636e72)" }
  ];

  const fixedChats = [
    { id: "nyashhelp", name: "NyashHelp", status: "ü©∑ –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏", avatar: "linear-gradient(135deg, #ff9acb, #ffd6e8)" },
    { id: "nyashtalk", name: "NyashTalk", status: "üíï –±–æ–ª—Ç–∞–µ–º –æ –º–∏–ª–æ–º", avatar: "linear-gradient(135deg, #a78bfa, #7ab8ff)" }
  ];

  function renderContacts() {
    const list = document.getElementById("contactsList");
    list.innerHTML = "";

    fixedChats.forEach(c => {
      const el = document.createElement("div");
      el.className = "contact fixed";
      el.innerHTML = `
        <div class="avatar" style="background:${c.avatar}"></div>
        <div class="info">
          <div class="name">${c.name}</div>
          <div class="status">${c.status}</div>
          <div class="draft" style="display:none; color:#ff9acb; font-size:12px;"></div>
        </div>
      `;
      if (chatData[c.id] && chatData[c.id].draft) {
        el.querySelector(".draft").textContent = "–ß–µ—Ä–Ω–æ–≤–∏–∫: " + chatData[c.id].draft.slice(0, 30) + "...";
        el.querySelector(".draft").style.display = "block";
      }
      el.onclick = () => openChat(c);
      list.appendChild(el);
    });

    contacts.forEach(c => {
      const el = document.createElement("div");
      el.className = "contact";
      el.innerHTML = `
        <div class="avatar" style="background:${c.avatar}"></div>
        <div class="info">
          <div class="name">${c.name}</div>
          <div class="status">${c.status}</div>
          <div class="draft" style="display:none; color:#ff9acb; font-size:12px;"></div>
        </div>
      `;
      if (chatData[c.id] && chatData[c.id].draft) {
        el.querySelector(".draft").textContent = "–ß–µ—Ä–Ω–æ–≤–∏–∫: " + chatData[c.id].draft.slice(0, 30) + "...";
        el.querySelector(".draft").style.display = "block";
      }
      el.onclick = () => openChat(c);
      list.appendChild(el);
    });
  }

  function openChat(contact) {
    currentChat = contact.id;
    if (!chatData[currentChat]) chatData[currentChat] = { messages: [], draft: "" };

    document.getElementById("chatName").textContent = contact.name;
    document.getElementById("chatStatus").textContent = contact.status;
    document.getElementById("chatAvatar").style.background = contact.avatar;

    const input = document.getElementById("messageInput");
    if (input) input.value = chatData[currentChat].draft || "";

    if (chatData[currentChat].messages.length === 0) {
      let greeting = "";
      if (contact.id === "nyashhelp") greeting = "–ü—Ä–∏–≤–µ—Ç! –Ø NyashHelp ü©∑ –°–ø—Ä–∞—à–∏–≤–∞–π –ø—Ä–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ~";
      else if (contact.id === "nyashtalk") greeting = "–ü—Ä–∏–≤–µ—Ç–∏–∫! –Ø NyashTalk üå∏ –î–∞–≤–∞–π –ø–æ–±–æ–ª—Ç–∞–µ–º –æ –º–∏–ª–æ–º~";
      else greeting = "–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ " + contact.name + " üòä";
      chatData[currentChat].messages.push({ from: "bot", text: greeting });
    }

    showScreen("chatScreen");
    renderMessages();
  }

  function sendMessage(text) {
    if (!text.trim()) return;

    chatData[currentChat].messages.push({ from: "me", text });
    chatData[currentChat].draft = "";
    document.getElementById("messageInput").value = "";
    renderMessages();
    renderContacts();

    // –®–∞–±–ª–æ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
    setTimeout(() => {
      let response = "–•–º–º... –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–Ω—å–∫–æ~ üíï";
      const name = document.getElementById("chatName").textContent;

      if (name === "Bestie") response = ["–ê–∞–∞, –∫–∞–∫ –º–∏–ª–æ! ü•∞ –û–±–Ω–∏–º–∞—à–∫–∏ —Ç–µ–±–µ!", "–¢—ã —Å–∞–º—ã–π –º–∏–ª—ã–π –≤ –º–∏—Ä–µ! üíï"][Math.floor(Math.random()*2)];
      else if (name === "–§–∏–ª–æ—Å–æ—Ñ") response = ["–°–∏–µ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å –±—ã—Ç–∏—è... üß†", "–ñ–∏–∑–Ω—å ‚Äî —ç—Ç–æ –≤–µ—á–Ω—ã–π –ø–æ–∏—Å–∫ –∏—Å—Ç–∏–Ω—ã."][Math.floor(Math.random()*2)];
      else if (name === "–£—á—ë–±–∞") response = "–ù–µ —Å–¥–∞–≤–∞–π—Å—è! –¢—ã —Å–ø—Ä–∞–≤–∏—à—å—Å—è üí™ –ü–æ–≤—Ç–æ—Ä—è–π –º–∞—Ç–µ—Ä–∏–∞–ª 3 —Ä–∞–∑–∞.";
      else if (name === "Music Pal") response = "–°–ª—É—à–∞—é –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å Billie Eilish ~ üéß –ê —Ç—ã —á—Ç–æ –∫–∞—á–∞–µ—à—å?";
      else if (name === "Night Chat") response = "–ù–æ—á—å —Ç–∞–∫–∞—è —Ç–∏—Ö–∞—è... üåô –†–∞—Å—Å–∫–∞–∂–∏, —á—Ç–æ —Ç–µ–±—è –Ω–µ –æ—Ç–ø—É—Å–∫–∞–µ—Ç —Å–ø–∞—Ç—å?";

      chatData[currentChat].messages.push({ from: "bot", text: response });
      renderMessages();
    }, 800);
  }

  function renderMessages() {
    const messages = document.getElementById("messages");
    const intro = document.getElementById("chatIntro");

    messages.innerHTML = "";
    intro.style.display = "none";

    if (chatData[currentChat]?.messages.length === 0) {
      intro.style.display = "block";
    }

    chatData[currentChat]?.messages.forEach(m => {
      const el = document.createElement("div");
      el.className = `message ${m.from}`;
      el.textContent = m.text;
      messages.appendChild(el);
    });

    messages.scrollTop = messages.scrollHeight;
  }

  // –ß–µ—Ä–Ω–æ–≤–∏–∫
  document.getElementById("messageInput").addEventListener("input", (e) => {
    if (currentChat) {
      chatData[currentChat].draft = e.target.value;
      renderContacts();
    }
  });

  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–ø—Ä–æ—Å—Ç–∞—è –∑–∞–≥–ª—É—à–∫–∞)
  document.getElementById("settingsBtn").onclick = () => showScreen("settingsScreen");
  document.getElementById("settingsBackBtn").onclick = () => showScreen("contactsScreen");
  document.getElementById("saveSettingsBtn").onclick = () => {
    alert("–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!");
    showScreen("contactsScreen");
  };

  // –ó–∞–ø—É—Å–∫
  showScreen("phoneScreen");
  </script>
</body>
</html>