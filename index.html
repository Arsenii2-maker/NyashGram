<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>NyashGram</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;500;700&family=Fredoka:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>

<div id="app">

  <!-- Экран ввода номера -->
  <section id="phoneScreen" class="screen active">
    <div class="container">
      <h1>NyashGram <span style="font-size:1.2em;">♥</span></h1>
      <p>Вход по номеру телефона</p>

      <div class="phone-input">
        <select id="countryCode">
          <option value="+7">+7 Россия</option>
          <option value="+380">+380 Украина</option>
          <option value="+375">+375 Беларусь</option>
        </select>
        <input type="tel" id="phoneNumber" placeholder="999 999 99 99" />
      </div>

      <div id="phoneError" style="color:#e74c3c; font-size:14px; margin:8px 0; min-height:20px;"></div>
      <button id="sendBtn" disabled>Получить код</button>
    </div>
  </section>

  <!-- Экран фейкового кода -->
  <section id="codeScreen" class="screen">
    <div class="container">
      <h1>NyashGram <span style="font-size:1.2em;">♥</span></h1>
      <p>Введи код</p>

      <input type="text" id="codeInput" placeholder="------" maxlength="6" autocomplete="off" />

      <div id="codeError" style="color:#e74c3c; font-size:14px; margin-top:12px; min-height:20px;"></div>
      <button id="verifyBtn" disabled>Войти</button>
    </div>
  </section>

  <!-- Экран профиля (короткий, сразу на контакты) -->
  <section id="profileScreen" class="screen">
    <div class="container">
      <h1>Создай профиль</h1>

      <input type="text" id="displayName" placeholder="Как тебя зовут?" style="width:100%; margin:16px 0;" />

      <div style="margin:20px 0;">
        <label for="avatarInput">
          <div id="avatarPreview" style="width:120px; height:120px; background:#ff9acb; border-radius:50%; margin:0 auto; display:flex; align-items:center; justify-content:center; font-size:40px; color:white;">+</div>
          <p style="margin-top:12px;">Выбрать фото (необязательно)</p>
        </label>
        <input type="file" id="avatarInput" accept="image/*" style="display:none;" />
      </div>

      <button id="saveProfileBtn">Готово!</button>
    </div>
  </section>

  <!-- Контакты -->
  <section id="contactsScreen" class="screen">
    <header class="top-bar">
      <button id="settingsBtn">⚙️</button>
      <div class="top-title">Контакты</div>
    </header>
    <div id="contactsList"></div>
  </section>

  <!-- ЧАТ -->
  <section id="chatScreen" class="screen">
    <header class="top-bar">
      <button id="backBtn">←</button>
      <div class="chat-header">
        <div id="chatAvatar" class="avatar"></div>
        <div>
          <div id="chatName"></div>
          <div id="chatStatus" class="status"></div>
        </div>
      </div>
    </header>

    <div id="chatIntro" class="chat-intro">
      <div class="intro-title">✨ Начни общение ✨</div>
      <div class="intro-buttons">
        <button>Привет! Как дела?</button>
        <button>Чем занимаешься?</button>
        <button>Хочешь поболтать?</button>
        <button>Какой вайб сегодня?</button>
      </div>
    </div>

    <div id="messages"></div>

    <div class="input-bar">
      <input id="messageInput" placeholder="Сообщение...">
      <button id="sendBtn">➤</button>
    </div>
  </section>

</div>

<script>
  let currentChat = null;
  const chatData = {}; // { chatId: { messages: [], draft: "" } }

  // Фейковый код
  let generatedCode = "";

  function generateCode() {
    generatedCode = Math.floor(100000 + Math.random() * 900000).toString();
    document.getElementById("codeInput").placeholder = generatedCode.split("").join(" ");
  }

  // Переключение экранов
  function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  // Экран номера
  const phoneInput = document.getElementById("phoneNumber");
  const sendBtn = document.getElementById("sendBtn");
  const phoneError = document.getElementById("phoneError");

  function checkPhone() {
    const phone = phoneInput.value.trim().replace(/\D/g, "");
    if (phone.length >= 9) {
      sendBtn.classList.add("active");
      sendBtn.disabled = false;
      phoneError.textContent = "";
    } else {
      sendBtn.classList.remove("active");
      sendBtn.disabled = true;
      phoneError.textContent = phone.length === 0 ? "" : "Номер слишком короткий";
    }
  }

  phoneInput.addEventListener("input", checkPhone);
  checkPhone();

  sendBtn.addEventListener("click", () => {
    generateCode();
    showScreen("codeScreen");
  });

  // Экран кода
  const codeInput = document.getElementById("codeInput");
  const verifyBtn = document.getElementById("verifyBtn");
  const codeError = document.getElementById("codeError");

  codeInput.addEventListener("input", () => {
    const entered = codeInput.value.trim();
    if (entered.length === 6) {
      if (entered === generatedCode) {
        codeError.textContent = "";
        verifyBtn.classList.add("active");
        verifyBtn.disabled = false;
      } else {
        codeError.textContent = "Неверный код";
        verifyBtn.classList.remove("active");
        verifyBtn.disabled = true;
      }
    } else {
      codeError.textContent = "";
      verifyBtn.classList.remove("active");
      verifyBtn.disabled = true;
    }
  });

  verifyBtn.addEventListener("click", () => {
    showScreen("contactsScreen");
    if (typeof renderContacts === 'function') renderContacts();
  });

  // Контакты и чаты — подключай свои файлы
  // renderContacts() из contacts.js
  // openChat(), renderMessages() из chat.js
</script>

<script src="contacts.js"></script>
<script src="chat.js"></script>
</body>
</html>