<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>NyashGram ‚Äî –≥–æ–≤–æ—Ä–∏ –ø–æ-–Ω—è—à–Ω–æ–º—É üíó</title>
  <link rel="stylesheet" href="style.css">
  <!-- –û—Å–Ω–æ–≤–Ω–æ–π —à—Ä–∏—Ñ—Ç Comfortaa + –∑–∞–ø–∞—Å–Ω—ã–µ -->
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;500;700&family=Quicksand:wght@400;500;600&family=Nunito:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    /* –ë–∞–∑–æ–≤—ã–µ —Å–±—Ä–æ—Å—ã –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–µ –≤ style.css */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Comfortaa', cursive;
      background: linear-gradient(145deg, #ffd1dc 0%, #ffe4e1 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    /* –≠–∫—Ä–∞–Ω—ã */
    .screen {
      position: absolute;
      inset: 0;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      box-sizing: border-box;
      width: 100%;
      height: 100vh;
      overflow-y: auto;
    }

    .screen.active {
      display: flex !important;
    }

    /* Glass-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ñ–æ—Ä–º */
    .glass-container {
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-radius: 32px;
      border: 1px solid rgba(255, 255, 255, 0.4);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.05), 0 8px 20px rgba(255, 192, 203, 0.3);
      padding: 32px 24px;
      width: 90%;
      max-width: 380px;
      text-align: center;
    }

    /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ */
    h1 {
      color: #9f6b8a;
      margin: 0 0 8px;
      font-size: 2.2rem;
      font-weight: 700;
      letter-spacing: -0.5px;
      text-shadow: 0 2px 10px rgba(255, 255, 255, 0.5);
    }

    .subtitle {
      color: #8b6f8b;
      margin: 0 0 24px;
      font-size: 1rem;
      font-weight: 400;
      opacity: 0.9;
    }

    /* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
    .phone-input {
      display: flex;
      gap: 10px;
      margin-bottom: 16px;
    }

    select, input {
      padding: 14px 16px;
      font-size: 16px;
      border: 1px solid rgba(255, 255, 255, 0.6);
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.6);
      backdrop-filter: blur(5px);
      font-family: 'Comfortaa', cursive;
      transition: all 0.2s;
    }

    select {
      flex: 0 0 auto;
      width: auto;
      background: rgba(255, 255, 255, 0.7);
    }

    input {
      flex: 1;
    }

    input:focus, select:focus {
      border-color: #ffa5b9;
      background: rgba(255, 255, 255, 0.9);
      outline: none;
      box-shadow: 0 0 0 3px rgba(255, 165, 185, 0.2);
    }

    /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è –ø–æ–ª—è –∫–æ–¥–∞ */
    #codeInput {
      width: 100%;
      padding: 18px 16px;
      font-size: 28px;
      text-align: center;
      letter-spacing: 10px;
      border: 1px solid rgba(255, 255, 255, 0.6);
      border-radius: 24px;
      background: rgba(255, 255, 255, 0.6);
      color: #4a3f4a;
      font-weight: 600;
    }

    #codeInput::placeholder {
      color: rgba(159, 107, 138, 0.4);
      letter-spacing: 10px;
      font-size: 24px;
    }

    /* –ö–Ω–æ–ø–∫–∏ */
    button {
      padding: 16px;
      font-size: 17px;
      background: rgba(255, 255, 255, 0.4);
      color: #8b6f8b;
      border: 1px solid rgba(255, 255, 255, 0.6);
      border-radius: 40px;
      width: 100%;
      cursor: not-allowed;
      transition: all 0.3s;
      margin: 12px 0;
      font-weight: 600;
      font-family: 'Comfortaa', cursive;
      backdrop-filter: blur(5px);
    }

    button.active {
      background: white;
      box-shadow: 0 6px 20px rgba(255, 120, 160, 0.4);
      border: 1px solid #ffa5b9;
      color: #d46b8d;
      cursor: pointer;
    }

    button.active:hover {
      transform: scale(1.02);
      background: #fff0f5;
    }

    /* –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö */
    .error-message {
      color: #e67e8f;
      font-size: 14px;
      margin: 4px 0 12px;
      min-height: 20px;
      font-weight: 500;
      text-shadow: 0 1px 3px rgba(255,255,255,0.5);
    }

    /* –ê–≤–∞—Ç–∞—ÄÈ¢ÑËßà */
    #avatarPreview {
      width: 120px;
      height: 120px;
      background: linear-gradient(135deg, #fbc2c2, #c2b9f0);
      border-radius: 50%;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      color: white;
      border: 3px solid white;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: transform 0.2s;
      background-size: cover;
      background-position: center;
    }

    #avatarPreview:hover {
      transform: scale(1.05);
    }

    /* –•–µ–¥–µ—Ä –¥–ª—è —ç–∫—Ä–∞–Ω–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ */
    .top-bar {
      width: 100%;
      padding: 20px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255,255,255,0.3);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .top-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: #9f6b8a;
      text-shadow: 0 2px 10px white;
    }

    #contactsList {
      width: 100%;
      max-width: 600px;
      padding: 16px;
      overflow-y: auto;
      flex: 1;
    }

    /* –î–ª—è —ç–∫—Ä–∞–Ω–∞ —á–∞—Ç–∞ */
    #chatHeader {
      width: 100%;
      padding: 16px 20px;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      gap: 12px;
      border-bottom: 1px solid rgba(255,255,255,0.3);
    }

    #backBtn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255,255,255,0.4);
      border: none;
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #9f6b8a;
      margin: 0;
      padding: 0;
    }

    #chatContactName {
      font-size: 1.4rem;
      font-weight: 600;
      color: #4a3f4a;
    }

    #chatArea {
      flex: 1;
      width: 100%;
      padding: 16px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    #messageInputArea {
      width: 100%;
      padding: 16px;
      background: rgba(255,255,255,0.2);
      backdrop-filter: blur(10px);
      display: flex;
      gap: 8px;
      border-top: 1px solid rgba(255,255,255,0.3);
    }

    #messageInput {
      flex: 1;
      padding: 14px 18px;
      border-radius: 30px;
      border: 1px solid rgba(255,255,255,0.6);
      background: rgba(255,255,255,0.6);
      font-family: 'Comfortaa', cursive;
    }

    #sendMessageBtn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: white;
      border: 1px solid #ffa5b9;
      color: #d46b8d;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0;
      padding: 0;
    }

    /* –ü–∞–Ω–µ–ª—å –±—ã—Å—Ç—Ä—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ */
    .quick-reply-panel {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      padding: 12px 16px;
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(5px);
      border-bottom: 1px solid rgba(255,255,255,0.3);
    }

    .quick-chip {
      background: rgba(255, 255, 255, 0.6);
      border: 1px solid rgba(255,255,255,0.8);
      border-radius: 40px;
      padding: 8px 18px;
      font-size: 14px;
      color: #4a3f4a;
      cursor: pointer;
      backdrop-filter: blur(4px);
      transition: 0.2s;
      font-family: 'Comfortaa', cursive;
    }

    .quick-chip:hover {
      background: white;
      box-shadow: 0 4px 10px rgba(255, 150, 180, 0.4);
    }
  </style>
</head>
<body>

  <!-- –≠–∫—Ä–∞–Ω –≤–≤–æ–¥–∞ –Ω–æ–º–µ—Ä–∞ -->
  <section id="phoneScreen" class="screen active">
    <div class="glass-container">
      <h1>NyashGram üíó</h1>
      <p class="subtitle">–í—Ö–æ–¥ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞</p>

      <div class="phone-input">
        <select id="countryCode">
          <option value="+7">üá∑üá∫ +7</option>
          <option value="+380">üá∫üá¶ +380</option>
          <option value="+375">üáßüáæ +375</option>
        </select>
        <input type="tel" id="phoneNumber" placeholder="999 999 99 99" />
      </div>

      <div id="errorMessage" class="error-message"></div>
      <button id="sendBtn" class="send-btn" disabled>‚ú® –ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥ ‚ú®</button>
      <p style="font-size:12px; color:#9f8b9f; margin-top:16px;">–í–≤–µ–¥–∏ –ª—é–±–æ–π –Ω–æ–º–µ—Ä</p>
    </div>
  </section>

  <!-- –≠–∫—Ä–∞–Ω –≤–≤–æ–¥–∞ –∫–æ–¥–∞ -->
  <section id="codeScreen" class="screen">
    <div class="glass-container">
      <h1>NyashGram üíó</h1>
      <p class="subtitle">–í–≤–µ–¥–∏ –∫–æ–¥ –∏–∑ —Å–º—Å</p>

      <input type="text" id="codeInput" placeholder="------" maxlength="6" autocomplete="off" />

      <div id="codeError" class="error-message"></div>
      <button id="verifyBtn" disabled>üíï –í–æ–π—Ç–∏ üíï</button>
      <p style="font-size:12px; color:#9f8b9f; margin-top:16px;">–ö–æ–¥: <span id="generatedCodeHint">******</span></p>
    </div>
  </section>

  <!-- –≠–∫—Ä–∞–Ω —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
  <section id="profileScreen" class="screen">
    <div class="glass-container">
      <h1>–°–æ–∑–¥–∞–π –ø—Ä–æ—Ñ–∏–ª—å üí´</h1>

      <input type="text" id="displayName" placeholder="–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?" style="width:100%; margin:16px 0;" />

      <div style="margin:20px 0;">
        <label for="avatarInput">
          <div id="avatarPreview">+</div>
          <p style="margin-top:12px; color:#8b6f8b;">–í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</p>
        </label>
        <input type="file" id="avatarInput" accept="image/*" style="display:none;" />
      </div>

      <button id="saveBtn">‚ú® –ì–æ—Ç–æ–≤–æ ‚ú®</button>
    </div>
  </section>

  <!-- –≠–∫—Ä–∞–Ω –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ -->
  <section id="contactsScreen" class="screen">
    <header class="top-bar">
      <div class="top-title">–ú–æ–π –º–∏—Ä–æ–∫ üíó</div>
      <div style="display:flex; gap:10px;">
        <button id="settingsBtn" style="width:auto; padding:8px 16px; margin:0;">‚öôÔ∏è</button>
      </div>
    </header>
    <div id="contactsList"></div>
  </section>

  <!-- –≠–∫—Ä–∞–Ω —á–∞—Ç–∞ -->
  <section id="chatScreen" class="screen">
    <header id="chatHeader">
      <button id="backBtn">‚Üê</button>
      <div style="display:flex; align-items:center; gap:10px;">
        <div id="chatAvatar" class="avatar" style="width:40px; height:40px;"></div>
        <span id="chatContactName">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
      </div>
    </header>
    
    <!-- –ü–∞–Ω–µ–ª—å –±—ã—Å—Ç—Ä—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (–±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏) -->
    <div id="quickReplyPanel" class="quick-reply-panel"></div>
    
    <div id="chatArea"></div>
    
    <div id="messageInputArea">
      <input type="text" id="messageInput" placeholder="–ù–∞–ø–∏—à–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å..." />
      <button id="sendMessageBtn">‚û§</button>
    </div>
  </section>

  <!-- –≠–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
  <section id="settingsScreen" class="screen">
    <header class="top-bar">
      <button id="backFromSettingsBtn" style="width:40px; height:40px; border-radius:50%; background:rgba(255,255,255,0.4); border:none;">‚Üê</button>
      <div class="top-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
      <div style="width:40px;"></div>
    </header>
    
    <div style="width:100%; max-width:500px; padding:20px; overflow-y:auto;">
      <div class="glass-container" style="margin-bottom:20px;">
        <h3 style="color:#9f6b8a; margin-bottom:16px;">–¢–≤–æ–π –Ω–∏–∫</h3>
        <input type="text" id="settingsName" placeholder="–ò–º—è" style="width:100%; margin-bottom:16px;" />
        <button id="saveSettingsBtn" class="active" style="margin-top:0;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
      
      <div class="glass-container" style="margin-bottom:20px;">
        <h3 style="color:#9f6b8a; margin-bottom:16px;">–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</h3>
        <div style="display:flex; flex-wrap:wrap; gap:10px; justify-content:center;">
          <button class="theme-btn active" data-theme="pastel">Pastel Pink</button>
          <button class="theme-btn" data-theme="milk">Milk Rose</button>
          <button class="theme-btn" data-theme="night">Night Blue</button>
        </div>
      </div>
      
      <div class="glass-container">
        <h3 style="color:#9f6b8a; margin-bottom:16px;">–®—Ä–∏—Ñ—Ç</h3>
        <div style="display:flex; flex-wrap:wrap; gap:10px; justify-content:center;">
          <button class="font-btn active" data-font="comfortaa">System</button>
          <button class="font-btn" data-font="quicksand">Rounded</button>
          <button class="font-btn" data-font="nunito">Cozy</button>
        </div>
      </div>
    </div>
  </section>

  <script>
    // ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
    let generatedCode = "";
    let currentUser = {
      name: "–ù—è—à–∞",
      avatar: null,
      theme: "pastel",
      font: "comfortaa"
    };

    // ========== –£–ü–†–ê–í–õ–ï–ù–ò–ï –≠–ö–†–ê–ù–ê–ú–ò ==========
    function showScreen(id) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      const screen = document.getElementById(id);
      if (screen) screen.classList.add('active');
      
      // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –ø–æ–∫–∞–∑–µ —ç–∫—Ä–∞–Ω–æ–≤
      if (id === 'contactsScreen' && typeof renderContacts === 'function') {
        renderContacts();
      }
    }

    // ========== –ì–ï–ù–ï–†–ê–¶–ò–Ø –§–ï–ô–ö–û–í–û–ì–û –ö–û–î–ê ==========
    function generateCode() {
      generatedCode = Math.floor(100000 + Math.random() * 900000).toString();
      document.getElementById("codeInput").placeholder = generatedCode.split("").join(" ");
      document.getElementById("generatedCodeHint").textContent = generatedCode;
    }

    // ========== –ü–†–û–í–ï–†–ö–ê –í–•–û–î–ê ==========
    function checkAuth() {
      const hasEntered = localStorage.getItem("nyashgram_entered");
      if (hasEntered === "true") {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        loadSettings();
        showScreen("contactsScreen");
        setTimeout(() => {
          if (typeof renderContacts === "function") renderContacts();
        }, 100);
      } else {
        showScreen("phoneScreen");
      }
    }

    // ========== –ó–ê–ì–†–£–ó–ö–ê –ù–ê–°–¢–†–û–ï–ö ==========
    function loadSettings() {
      const savedName = localStorage.getItem("nyashgram_name");
      const savedTheme = localStorage.getItem("nyashgram_theme");
      const savedFont = localStorage.getItem("nyashgram_font");
      
      if (savedName) currentUser.name = savedName;
      if (savedTheme) {
        currentUser.theme = savedTheme;
        applyTheme(savedTheme);
      }
      if (savedFont) {
        currentUser.font = savedFont;
        applyFont(savedFont);
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ –∏–º–µ–Ω–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
      const settingsName = document.getElementById("settingsName");
      if (settingsName) settingsName.value = currentUser.name;
    }

    // ========== –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –¢–ï–ú–´ ==========
    function applyTheme(theme) {
      document.body.className = ''; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–ª–∞—Å—Å—ã
      if (theme === 'pastel') {
        document.body.style.background = 'linear-gradient(145deg, #ffd1dc, #ffe4e1)';
      } else if (theme === 'milk') {
        document.body.style.background = 'linear-gradient(145deg, #f9e6e6, #f5d9d9)';
      } else if (theme === 'night') {
        document.body.style.background = 'linear-gradient(145deg, #d4e0f0, #c0d0e8)';
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É —Ç–µ–º—ã
      document.querySelectorAll('.theme-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.theme === theme) btn.classList.add('active');
      });
    }

    // ========== –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –®–†–ò–§–¢–ê ==========
    function applyFont(font) {
      const fontMap = {
        'comfortaa': "'Comfortaa', cursive",
        'quicksand': "'Quicksand', sans-serif",
        'nunito': "'Nunito', sans-serif"
      };
      document.body.style.fontFamily = fontMap[font] || "'Comfortaa', cursive";
      
      document.querySelectorAll('.font-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.font === font) btn.classList.add('active');
      });
    }

    // ========== –≠–ö–†–ê–ù –ù–û–ú–ï–†–ê ==========
    const phoneInput = document.getElementById("phoneNumber");
    const sendBtn = document.getElementById("sendBtn");
    const errorMsg = document.getElementById("errorMessage");

    function checkPhone() {
      const phone = phoneInput.value.trim().replace(/\D/g, "");
      if (phone.length >= 9) {
        sendBtn.classList.add("active");
        sendBtn.disabled = false;
        errorMsg.textContent = "";
      } else {
        sendBtn.classList.remove("active");
        sendBtn.disabled = true;
        errorMsg.textContent = phone.length === 0 ? "" : "–ù–æ–º–µ—Ä —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π";
      }
    }

    phoneInput.addEventListener("input", checkPhone);
    checkPhone();

    sendBtn.addEventListener("click", () => {
      generateCode();
      showScreen("codeScreen");
    });

    // ========== –≠–ö–†–ê–ù –ö–û–î–ê ==========
    const codeInput = document.getElementById("codeInput");
    const verifyBtn = document.getElementById("verifyBtn");
    const codeError = document.getElementById("codeError");

    codeInput.addEventListener("input", () => {
      const entered = codeInput.value.trim();
      if (entered.length === 6) {
        if (entered === generatedCode) {
          codeError.textContent = "";
          verifyBtn.classList.add("active");
          verifyBtn.disabled = false;
        } else {
          codeError.textContent = "–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥";
          verifyBtn.classList.remove("active");
          verifyBtn.disabled = true;
        }
      } else {
        codeError.textContent = "";
        verifyBtn.classList.remove("active");
        verifyBtn.disabled = true;
      }
    });

    // ========== –ü–†–û–§–ò–õ–¨ ==========
    document.getElementById("avatarInput").addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (event) => {
          const preview = document.getElementById("avatarPreview");
          preview.style.backgroundImage = `url(${event.target.result})`;
          preview.style.backgroundSize = "cover";
          preview.textContent = "";
          currentUser.avatar = event.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    document.getElementById("saveBtn").addEventListener("click", () => {
      const name = document.getElementById("displayName").value.trim();
      if (!name) {
        alert("–í–≤–µ–¥–∏ –∏–º—è!");
        return;
      }
      
      currentUser.name = name;
      localStorage.setItem("nyashgram_name", name);
      localStorage.setItem("nyashgram_entered", "true");
      
      alert("–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å üíó");
      showScreen("contactsScreen");
      if (typeof renderContacts === "function") renderContacts();
    });

    // ========== –ù–ê–°–¢–†–û–ô–ö–ò ==========
    document.getElementById("settingsBtn")?.addEventListener("click", () => {
      document.getElementById("settingsName").value = currentUser.name;
      showScreen("settingsScreen");
    });

    document.getElementById("backFromSettingsBtn")?.addEventListener("click", () => {
      showScreen("contactsScreen");
    });

    document.getElementById("saveSettingsBtn")?.addEventListener("click", () => {
      const newName = document.getElementById("settingsName").value.trim();
      if (newName) {
        currentUser.name = newName;
        localStorage.setItem("nyashgram_name", newName);
      }
      showScreen("contactsScreen");
      if (typeof renderContacts === "function") renderContacts();
    });

    // –ö–Ω–æ–ø–∫–∏ —Ç–µ–º
    document.querySelectorAll('.theme-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const theme = btn.dataset.theme;
        currentUser.theme = theme;
        localStorage.setItem("nyashgram_theme", theme);
        applyTheme(theme);
      });
    });

    // –ö–Ω–æ–ø–∫–∏ —à—Ä–∏—Ñ—Ç–æ–≤
    document.querySelectorAll('.font-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const font = btn.dataset.font;
        currentUser.font = font;
        localStorage.setItem("nyashgram_font", font);
        applyFont(font);
      });
    });

    // ========== –ù–ê–í–ò–ì–ê–¶–ò–Ø –ß–ê–¢–ê ==========
    document.getElementById("backBtn")?.addEventListener("click", () => {
      showScreen("contactsScreen");
    });

    // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
    document.addEventListener('DOMContentLoaded', () => {
      checkAuth();
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è verifyBtn (–µ—Å–ª–∏ –∏—Ö –Ω–µ—Å–∫–æ–ª—å–∫–æ, —É–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏)
      const oldVerifyBtn = verifyBtn;
      const newVerifyBtn = oldVerifyBtn.cloneNode(true);
      oldVerifyBtn.parentNode.replaceChild(newVerifyBtn, oldVerifyBtn);
      
      newVerifyBtn.addEventListener("click", () => {
        const entered = codeInput.value.trim();
        if (entered === generatedCode) {
          codeError.textContent = "";
          localStorage.setItem("nyashgram_entered", "true");
          showScreen("contactsScreen");
          if (typeof renderContacts === "function") renderContacts();
        } else {
          codeError.textContent = "–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥";
        }
      });
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ verifyBtn
      window.verifyBtn = newVerifyBtn;
    });
  </script>
  <script>
  // –≠–ö–°–¢–†–ï–ù–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–í–æ–π—Ç–∏"
  (function() {
    console.log("üîß –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –∫–Ω–æ–ø–∫–∏ '–í–æ–π—Ç–∏'");
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–¥–∞ –∏–∑ placeholder
    function getCodeFromPlaceholder() {
      const codeInput = document.getElementById('codeInput');
      if (!codeInput) return '';
      return codeInput.placeholder.replace(/\s/g, '');
    }
    
    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞
    function checkCodeInput() {
      const codeInput = document.getElementById('codeInput');
      const verifyBtn = document.getElementById('verifyBtn');
      const codeError = document.getElementById('codeError');
      
      if (!codeInput || !verifyBtn) return;
      
      const entered = codeInput.value.trim();
      const expected = codeInput.placeholder.replace(/\s/g, '');
      
      if (entered.length === 6) {
        if (entered === expected) {
          if (codeError) codeError.textContent = '';
          verifyBtn.classList.add('active');
          verifyBtn.disabled = false;
        } else {
          if (codeError) codeError.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥';
          verifyBtn.classList.remove('active');
          verifyBtn.disabled = true;
        }
      } else {
        if (codeError) codeError.textContent = '';
        verifyBtn.classList.remove('active');
        verifyBtn.disabled = true;
      }
    }
    
    // –ñ–¥—ë–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
      console.log("üîß DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∏—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã...");
      
      const codeInput = document.getElementById('codeInput');
      const verifyBtn = document.getElementById('verifyBtn');
      
      if (!codeInput || !verifyBtn) {
        console.error("üîß –ù–µ –Ω–∞–π–¥–µ–Ω—ã —ç–ª–µ–º–µ–Ω—Ç—ã –≤–≤–æ–¥–∞ –∫–æ–¥–∞ –∏–ª–∏ –∫–Ω–æ–ø–∫–∞!");
        return;
      }
      
      console.log("üîß –≠–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏");
      
      // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å input
      const newCodeInput = codeInput.cloneNode(true);
      codeInput.parentNode.replaceChild(newCodeInput, codeInput);
      
      // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å –∫–Ω–æ–ø–∫–∏
      const newVerifyBtn = verifyBtn.cloneNode(true);
      verifyBtn.parentNode.replaceChild(newVerifyBtn, verifyBtn);
      
      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ input
      newCodeInput.addEventListener('input', checkCodeInput);
      
      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É
      newVerifyBtn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        console.log("üîß –ö–Ω–æ–ø–∫–∞ '–í–æ–π—Ç–∏' –Ω–∞–∂–∞—Ç–∞");
        console.log("üîß –ö–ª–∞—Å—Å—ã –∫–Ω–æ–ø–∫–∏:", this.className);
        console.log("üîß Disabled:", this.disabled);
        
        if (!this.disabled && this.classList.contains('active')) {
          const entered = newCodeInput.value.trim();
          const expected = newCodeInput.placeholder.replace(/\s/g, '');
          
          console.log("üîß –í–≤–µ–¥—ë–Ω –∫–æ–¥:", entered);
          console.log("üîß –û–∂–∏–¥–∞–µ–º—ã–π –∫–æ–¥:", expected);
          
          if (entered === expected) {
            console.log("üîß –ö–æ–¥ –≤–µ—Ä–Ω—ã–π, –≤—ã–ø–æ–ª–Ω—è–µ–º –≤—Ö–æ–¥");
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–ª–∞–≥ –≤—Ö–æ–¥–∞
            localStorage.setItem("nyashgram_entered", "true");
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–º—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            if (!localStorage.getItem("nyashgram_name")) {
              localStorage.setItem("nyashgram_name", "–ù—è—à–∞");
            }
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —ç–∫—Ä–∞–Ω
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            const contactsScreen = document.getElementById('contactsScreen');
            if (contactsScreen) {
              contactsScreen.classList.add('active');
              
              // –†–µ–Ω–¥–µ—Ä–∏–º –∫–æ–Ω—Ç–∞–∫—Ç—ã
              setTimeout(() => {
                if (typeof renderContacts === 'function') {
                  renderContacts();
                }
              }, 100);
            }
          } else {
            const codeError = document.getElementById('codeError');
            if (codeError) {
              codeError.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥';
            }
          }
        }
      });
      
      // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
      setTimeout(checkCodeInput, 100);
      
      console.log("üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!");
    });
  })();
</script>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –≤–Ω–µ—à–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç—ã -->
  <script src="contacts.js"></script>
  <script src="chat.js"></script>
  <script src="app.js"></script>
</body>
</html>